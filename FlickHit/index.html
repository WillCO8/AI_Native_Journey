<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FlickHit 🎵📸</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 40px;
      background: #f5f5f5;
    }
    h1 {
      font-size: 2.5em;
    }
    #dropzone {
      border: 2px dashed #3498db;
      background-color: #fff;
      padding: 40px;
      margin: 30px auto;
      width: 70%;
      cursor: pointer;
      border-radius: 12px;
    }
    #dropzone:hover {
      background-color: #eef7ff;
    }
    img {
      margin-top: 20px;
      max-width: 300px;
      border-radius: 10px;
    }
    .info {
      margin-top: 30px;
      font-size: 1.1em;
    }
    .info a {
      display: block;
      margin-top: 10px;
      color: #007bff;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <h1>FlickHit 🎵📸</h1>
  <div id="dropzone">📸 Click to upload or drag Flick to get Hit</div>
  <input type="file" id="fileInput" style="display:none" accept="image/*">
  <img id="preview" src="" alt="" />
  <div class="info" id="output"></div>

  <script src="https://cdn.jsdelivr.net/npm/exifr/dist/lite.umd.js"></script>
  <script>
    const dropzone = document.getElementById('dropzone');
    const fileInput = document.getElementById('fileInput');
    const preview = document.getElementById('preview');
    const output = document.getElementById('output');
    let chartData = [];

    // Replace this with your real GitHub raw link
    fetch('YOUR_JSON_LINK_HERE')
      .then(response => response.json())
      .then(data => { chartData = data; });

    // Click-to-upload
    dropzone.addEventListener('click', () => fileInput.click());

    // Drag & drop support
    dropzone.addEventListener('dragover', e => e.preventDefault());
    dropzone.addEventListener('drop', e => {
      e.preventDefault();
      handleFile(e.dataTransfer.files[0]);
    });
    fileInput.addEventListener('change', () => handleFile(fileInput.files[0]));

    function handleFile(file) {
      preview.src = URL.createObjectURL(file);
      preview.style.display = 'block';
      output.innerHTML = 'Reading date...';

      exifr.parse(file).then(meta => {
        const photoDate = new Date(meta?.DateTimeOriginal || file.lastModified);
        const formattedDate = photoDate.toISOString().split('T')[0];
        const song = findClosestChartSong(formattedDate);

        if (song) {
          output.innerHTML = `
            <strong>📅 Photo Date:</strong> ${formattedDate}<br>
            <strong>🎵 Song:</strong> ${song.title}<br>
            <strong>👤 Artist:</strong> ${song.artist}<br>
            <strong>🏆 Chart Position:</strong> #${song.rank}<br>
            <strong>💿 Album:</strong> ${song.album}<br>
            ${song.youtube ? `<a href="${song.youtube}" target="_blank">▶️ Watch on YouTube</a>` : ''}
            ${song.spotify ? `<a href="${song.spotify}" target="_blank">🎧 Listen on Spotify</a>` : ''}
            ${song.apple ? `<a href="${song.apple}" target="_blank">🍎 Listen on Apple Music</a>` : ''}
          `;
        } else {
          output.innerHTML = `No chart data found for this photo.`;
        }
      });
    }

    function findClosestChartSong(dateStr) {
      const targetDate = new Date(dateStr);
      return chartData.reduce((closest, current) => {
        const currentDiff = Math.abs(new Date(current.date) - targetDate);
        const closestDiff = Math.abs(new Date(closest.date) - targetDate);
        return currentDiff < closestDiff ? current : closest;
      });
    }
  </script>
</body>
</html>
